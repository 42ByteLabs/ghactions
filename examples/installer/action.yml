# This file is generated by ghactions
# Do not edit this file manually unless you disable the `generate` feature.

name: My Action
description: My Action Description
author: GeekMasher
branding:
  color: green
  icon: star
inputs:
  repo:
    description: Repository Name
    default: ${{ github.repository }}
  token:
    description: GitHub Token
    default: ${{ github.token }}
  mode:
    description: Mode
    default: 'false'
  crates:
    description: Crate names (comma separated)
outputs:
  version:
    description: Output Version
    value: ${{ steps.cargo-run.outputs.version }}
runs:
  using: composite
  steps:
  - name: Install the Action
    id: install-action
    if: ${{ runner.os == 'Linux' || runner.os == 'macOS' }}
    env:
      ACTION_REPOSITORY: ${{ github.action_repository }}
      ACTION_REF: ${{ github.action_ref }}
      BINARY_NAME: installer
      GH_TOKEN: ${{ github.token }}
      RUNNER_OS: ${{ runner.os }}
      RUNNER_ARCH: ${{ runner.arch }}
    shell: bash
    run: |+
      # This script installs the specified version of the action from GitHub releases.
      set -e

      if [[ ! "$ACTION_REF" =~ ^v?[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
          VERSION=$(gh release list --repo "$ACTION_REPOSITORY" --limit 1 | awk '{print $1}')
      else
          VERSION="v${VERSION}"
      fi
      echo "GitHub Action Repository :: $ACTION_REPOSITORY (${VERSION})"
      echo "Runner :: $RUNNER_OS ($RUNNER_ARCH)"

      gh release download \
          "${VERSION}" \
          --repo "https://github.com/$ACTION_REPOSITORY" \
          --pattern "${BINARY_NAME}-${RUNNER_OS}-${RUNNER_ARCH}.tar.gz" --clobber \
          --output "/tmp/${RUNNER_OS}-${RUNNER_ARCH}.tar.gz"

      tar -xzf "/tmp/${RUNNER_OS}-${RUNNER_ARCH}.tar.gz" -C "/tmp"

      if [ -f "/tmp/${BINARY_NAME}" ]; then
          mv "/tmp/${BINARY_NAME}" /usr/local/bin/
          chmod +x "/usr/local/bin/${BINARY_NAME}"
      else
          echo "Error: Action not found in the downloaded archive."
          exit 1
      fi

      echo "GitHub Action installed successfully."

  - name: Run the Action
    id: cargo-run
    shell: bash
    run: |-
      set -e
      installer
